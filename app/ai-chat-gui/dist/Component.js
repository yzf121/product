sap.ui.define(["sap/ui/core/UIComponent","sap/m/MessageToast"],function(t,a){"use strict";var e="ai_chat_conversations";var i=100;return t.extend("com.ai.assistant.aichatapp.Component",{metadata:{manifest:"json"},_aAllConversations:[],init:function(){t.prototype.init.apply(this,arguments);this.getRouter().initialize();this._loadConversationsFromStorage()},_loadConversationsFromStorage:function(){try{var t=localStorage.getItem(e);if(t){var a=JSON.parse(t);if(Array.isArray(a)){a=a.map(function(t){if(!t.aiType){t.aiType="abap-clean-core"}if(!Array.isArray(t.attachments)){t.attachments=[]}return t});this._aAllConversations=a}}}catch(t){try{localStorage.removeItem(e)}catch(t){}}},_sanitizeConversationsForStorage:function(t){return(t||[]).map(function(t){var a=Object.assign({},t);if(Array.isArray(t.attachments)){a.attachments=t.attachments.map(function(t){var a=Object.assign({},t);if(a.file){delete a.file}return a})}return a})},saveConversationsToStorage:function(){var t=this._aAllConversations||[];try{if(t.length>i){t=t.slice(0,i);this._aAllConversations=t}var o=this._sanitizeConversationsForStorage(t);localStorage.setItem(e,JSON.stringify(o))}catch(i){if(i.name==="QuotaExceededError"||i.code===22){if(t.length>1){t=t.slice(0,Math.floor(t.length/2));this._aAllConversations=t;try{var o=this._sanitizeConversationsForStorage(t);localStorage.setItem(e,JSON.stringify(o));a.show("存储空间不足，已自动清理部分历史对话")}catch(t){a.show("存储空间不足，无法保存对话历史")}}else{a.show("存储空间不足，无法保存对话历史")}}}}})});
//# sourceMappingURL=Component.js.map