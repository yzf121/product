# å‰ç«¯æ¨¡å—è¯´æ˜

> **æŠ€æœ¯æ ˆ**: SAP UI5 Freestyle  
> **æœ€ä½ç‰ˆæœ¬**: UI5 1.120.0  
> **åº”ç”¨ ID**: com.ai.assistant.aichatapp

---

## ğŸ“ ç›®å½•ç»“æ„

```
app/ai-chat-gui/webapp/
â”œâ”€â”€ Component.js          # UI5 ç»„ä»¶å…¥å£ï¼Œç®¡ç†å…¨å±€çŠ¶æ€
â”œâ”€â”€ index.html            # åº”ç”¨å…¥å£ HTML
â”œâ”€â”€ manifest.json         # åº”ç”¨æè¿°ç¬¦ï¼ˆè·¯ç”±ã€æ¨¡å‹ã€èµ„æºé…ç½®ï¼‰
â”œâ”€â”€ controller/           # MVC æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ App.controller.js
â”‚   â”œâ”€â”€ Home.controller.js
â”‚   â”œâ”€â”€ Main.controller.js
â”‚   â””â”€â”€ Diagram.controller.js
â”œâ”€â”€ view/                 # XML è§†å›¾
â”‚   â”œâ”€â”€ App.view.xml
â”‚   â”œâ”€â”€ Home.view.xml
â”‚   â”œâ”€â”€ Main.view.xml
â”‚   â”œâ”€â”€ Diagram.view.xml
â”‚   â””â”€â”€ DrawioDialog.fragment.xml
â”œâ”€â”€ css/                  # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ style.css
â”œâ”€â”€ i18n/                 # å›½é™…åŒ–èµ„æº
â”‚   â”œâ”€â”€ i18n.properties
â”‚   â”œâ”€â”€ i18n_en.properties
â”‚   â””â”€â”€ i18n_zh_CN.properties
â”œâ”€â”€ images/               # å›¾ç‰‡èµ„æº
â”œâ”€â”€ lib/                  # ç¬¬ä¸‰æ–¹åº“
â””â”€â”€ model/                # æ•°æ®æ¨¡å‹
```

---

## ğŸ  é¦–é¡µæ¨¡å— (Home)

### æ–‡ä»¶ä½ç½®
- **è§†å›¾**: `view/Home.view.xml`
- **æ§åˆ¶å™¨**: `controller/Home.controller.js`

### åŠŸèƒ½æè¿°

é¦–é¡µé‡‡ç”¨ SAP Fiori Launchpad é£æ ¼è®¾è®¡ï¼Œæ˜¯åº”ç”¨çš„å…¥å£é¡µé¢ã€‚

### é¡µé¢ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [è®¾ç½®å›¾æ ‡]             AI åŠ©æ‰‹å¹³å°            [Logo] â”‚ â† é¡µçœ‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚                    æ¬¢è¿åŒºåŸŸ                          â”‚
â”‚            AI çŸ¥è¯†åº“åŠ©æ‰‹ - æ™ºèƒ½å¼€å‘ä¼™ä¼´              â”‚
â”‚                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  AI åŠ©æ‰‹                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚  â”‚ABAP  â”‚ â”‚ CPI  â”‚ â”‚åŠŸèƒ½  â”‚ â”‚æŠ€æœ¯  â”‚ â”‚ä»£ç   â”‚ â”‚å•å…ƒ  â”‚ â† ç£è´´
â”‚  â”‚Clean â”‚ â”‚é›†æˆ  â”‚ â”‚æ–‡æ¡£  â”‚ â”‚æ–‡æ¡£  â”‚ â”‚å®¡æŸ¥  â”‚ â”‚æµ‹è¯•  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å·¥å…·                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  â”‚ æµç¨‹å›¾ç”Ÿæˆ    â”‚                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç£è´´é…ç½®

#### AI åŠ©æ‰‹åˆ†ç±»

| ç£è´´åç§° | aiType | å›¾æ ‡ | æ ·å¼ç±» |
|---------|--------|------|--------|
| ABAP Clean Core | `abap-clean-core` | `sap-icon://syntax` | `aiTile` |
| CPI é›†æˆ | `cpi` | `sap-icon://connected` | `aiTile` |
| åŠŸèƒ½æ–‡æ¡£ç”Ÿæˆ | `func-doc` | `sap-icon://document-text` | `aiTile` |
| æŠ€æœ¯æ–‡æ¡£ç”Ÿæˆ | `tech-doc` | `sap-icon://technical-object` | `aiTile` |

#### å·¥å…·åˆ†ç±»

| ç£è´´åç§° | aiType | å›¾æ ‡ | æ ·å¼ç±» |
|---------|--------|------|--------|
| æµç¨‹å›¾ç”Ÿæˆ | (å·¥å…·) | `sap-icon://workflow-tasks` | `diagramTile` |
| ä»£ç å®¡æŸ¥ | `code-review` | `sap-icon://inspect` | `toolTile` |
| å•å…ƒæµ‹è¯•ç”Ÿæˆ | `unit-test` | `sap-icon://checklist-item` | `toolTile` |

### å…³é”®æ–¹æ³•

```javascript
onTilePress(oEvent)        // ç£è´´ç‚¹å‡»ï¼Œå¯¼èˆªåˆ°å¯¹åº”èŠå¤©é¡µé¢
onDiagramTilePress()       // æµç¨‹å›¾ç£è´´ç‚¹å‡»ï¼Œå¯¼èˆªåˆ° Diagram é¡µé¢
onSettingsPress()          // è®¾ç½®æŒ‰é’®ç‚¹å‡»ï¼Œæ˜¾ç¤ºå…³äºä¿¡æ¯
```

---

## ğŸ’¬ èŠå¤©æ¨¡å— (Main)

### æ–‡ä»¶ä½ç½®
- **è§†å›¾**: `view/Main.view.xml`
- **æ§åˆ¶å™¨**: `controller/Main.controller.js`

### åŠŸèƒ½æè¿°

ä¸»è¦çš„ AI å¯¹è¯äº¤äº’ç•Œé¢ï¼Œæ”¯æŒå¤šè½®å¯¹è¯ã€æµå¼å“åº”ã€Markdown æ¸²æŸ“ç­‰åŠŸèƒ½ã€‚

### é¡µé¢ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â†] [â˜°]     ABAP Clean Core åŠ©æ‰‹                             â”‚ â† é¡µçœ‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  â”‚                                            â”‚
â”‚  å¯¹è¯å†å²åˆ—è¡¨     â”‚         æ¶ˆæ¯å±•ç¤ºåŒºåŸŸ                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  [+ æ–°å»ºå¯¹è¯]   â”‚  â”‚ ğŸ‘¤ ç”¨æˆ·æ¶ˆæ¯                         â”‚   â”‚
â”‚                  â”‚  â”‚    è¿™æ˜¯ç”¨æˆ·å‘é€çš„æ¶ˆæ¯...             â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”‚ å¯¹è¯ 1    â”‚  â”‚                                            â”‚
â”‚  â”‚ [ç¼–è¾‘][åˆ ]â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚ ğŸ¤– AI å›å¤                          â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚    è¿™æ˜¯ AI çš„å›å¤å†…å®¹...             â”‚   â”‚
â”‚  â”‚ å¯¹è¯ 2    â”‚  â”‚  â”‚    ```javascript                    â”‚   â”‚
â”‚  â”‚ [ç¼–è¾‘][åˆ ]â”‚  â”‚  â”‚    // ä»£ç ç¤ºä¾‹                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚    ```                               â”‚   â”‚
â”‚                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                  â”‚                                            â”‚
â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  â”‚  ğŸ“ [é™„ä»¶1] [é™„ä»¶2]                        â”‚ â† é™„ä»¶é¢„è§ˆ
â”‚                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                  â”‚  â”‚ [ğŸ“] [è¾“å…¥æ¡†...]               [â¤] â”‚   â”‚ â† è¾“å…¥åŒº
â”‚                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒåŠŸèƒ½

#### 1. æ¶ˆæ¯å‘é€ä¸æ¥æ”¶

```javascript
onSendMessage()                    // å‘é€æ¶ˆæ¯å…¥å£
_callAIStream(sMessage, sMessageId) // è°ƒç”¨ AI æµå¼æ¥å£
_renderUserMessage(oMessage)       // æ¸²æŸ“ç”¨æˆ·æ¶ˆæ¯
_renderAIMessageContainer(sMessageId) // æ¸²æŸ“ AI æ¶ˆæ¯å®¹å™¨
_updateAIMessageContent(sMessageId, sContent) // æµå¼æ›´æ–°å†…å®¹
_finalizeAIMessage(sMessageId, sContent) // å®Œæˆæ¶ˆæ¯æ¸²æŸ“
```

#### 2. ä¼šè¯ç®¡ç†ç­–ç•¥

ç³»ç»Ÿé‡‡ç”¨æ··åˆä¼šè¯ç­–ç•¥ï¼Œä¸æœåŠ¡ç«¯ä¿æŒä¸€è‡´ï¼š

```javascript
_SESSION_CONFIG: {
    MAX_ROUNDS: 50,        // ç™¾ç‚¼ API é™åˆ¶ï¼šæœ€å¤š50è½®
    EXPIRE_HOURS: 1,       // ç™¾ç‚¼ API é™åˆ¶ï¼š1å°æ—¶è¿‡æœŸ
    FALLBACK_ROUNDS: 10    // é™çº§æ—¶ä½¿ç”¨çš„å†å²è½®æ•°
}
```

- **ä¼˜å…ˆæ¨¡å¼**: ä½¿ç”¨ `session_id`ï¼ˆäº‘ç«¯å­˜å‚¨ä¸Šä¸‹æ–‡ï¼ŒèŠ‚çœ tokenï¼‰
- **é™çº§æ¨¡å¼**: è¶…è¿‡ 50 è½®æˆ– 1 å°æ—¶åï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ° `messages` æ¨¡å¼
- **æœ¬åœ°å­˜å‚¨**: å¯¹è¯å†å²ä¿å­˜åœ¨ localStorage

#### 3. Markdown æ¸²æŸ“

```javascript
_renderMarkdown(sContent)  // ä½¿ç”¨ marked.js è§£æ Markdown
_highlightCode(oElement)   // ä½¿ç”¨ highlight.js é«˜äº®ä»£ç 
_addCopyButtons(oElement)  // ä¸ºä»£ç å—æ·»åŠ å¤åˆ¶æŒ‰é’®
```

#### 4. æ–‡ä»¶ä¸Šä¼ 

```javascript
onUploadFile()                    // è§¦å‘æ–‡ä»¶é€‰æ‹©
_handleFileSelect(oEvent)         // å¤„ç†æ–‡ä»¶é€‰æ‹©
_uploadFile(oFile)                // ä¸Šä¼ æ–‡ä»¶åˆ°åç«¯
_pollFileStatus(sFileId)          // è½®è¯¢æ–‡ä»¶è§£æçŠ¶æ€
_renderAttachmentCard(oAttachment) // æ¸²æŸ“é™„ä»¶å¡ç‰‡
_getReadySessionFileIds()         // è·å–å·²å°±ç»ªçš„æ–‡ä»¶ ID åˆ—è¡¨
```

#### 5. å¯¹è¯åˆ—è¡¨æ“ä½œ

```javascript
onNewConversation()              // æ–°å»ºå¯¹è¯
onConversationSelect(oEvent)     // é€‰æ‹©å¯¹è¯
onEditConversationTitle(oEvent)  // ç¼–è¾‘å¯¹è¯æ ‡é¢˜
onDeleteConversation(oEvent)     // åˆ é™¤å¯¹è¯
_filterConversationsByAiType(sAiType) // æŒ‰ AI ç±»å‹è¿‡æ»¤å¯¹è¯
```

#### 6. é”®ç›˜å¿«æ·é”®

```javascript
_bindKeyboardShortcut()  // ç»‘å®šé”®ç›˜äº‹ä»¶
// Enter: å‘é€æ¶ˆæ¯
// Shift+Enter: æ¢è¡Œ
```

### æ–‡ä»¶ä¸Šä¼ é…ç½®

```javascript
FILE_UPLOAD_CONFIG = {
    MAX_FILE_SIZE: 50 * 1024 * 1024,  // 50MB
    MAX_FILES_PER_SESSION: 5,
    ALLOWED_EXTENSIONS: ['.pdf', '.doc', '.docx', '.txt', '.md', '.json', 
                         '.xml', '.csv', '.xlsx', '.xls', '.ppt', '.pptx']
}
```

### æ–‡ä»¶ç±»å‹å›¾æ ‡æ˜ å°„

```javascript
FILE_TYPE_ICONS = {
    'pdf': { icon: '&#xe9c6;', class: 'pdf' },
    'doc': { icon: '&#xe9ca;', class: 'doc' },
    'docx': { icon: '&#xe9ca;', class: 'docx' },
    'xls': { icon: '&#xe9c9;', class: 'xls' },
    'xlsx': { icon: '&#xe9c9;', class: 'xlsx' },
    'ppt': { icon: '&#xe9c5;', class: 'ppt' },
    'pptx': { icon: '&#xe9c5;', class: 'pptx' },
    'txt': { icon: '&#xe9ce;', class: 'txt' },
    'md': { icon: '&#xe9ce;', class: 'md' },
    'json': { icon: '&#xe9ce;', class: 'json' },
    'xml': { icon: '&#xe9ce;', class: 'xml' },
    'csv': { icon: '&#xe9c9;', class: 'csv' },
    'default': { icon: '&#xe9c4;', class: 'default' }
}
```

---

## ğŸ“Š æµç¨‹å›¾æ¨¡å— (Diagram)

### æ–‡ä»¶ä½ç½®
- **è§†å›¾**: `view/Diagram.view.xml`
- **æ§åˆ¶å™¨**: `controller/Diagram.controller.js`
- **ç‰‡æ®µ**: `view/DrawioDialog.fragment.xml`

### åŠŸèƒ½æè¿°

AI é©±åŠ¨çš„ Mermaid æµç¨‹å›¾ç”Ÿæˆå·¥å…·ï¼Œæ”¯æŒ AI ç”Ÿæˆã€æ‰‹åŠ¨ç¼–è¾‘ã€å¤šæ ¼å¼å¯¼å‡ºç­‰åŠŸèƒ½ã€‚

### é¡µé¢ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â†]              æµç¨‹å›¾ç”Ÿæˆå™¨                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        â”‚          é¢„è§ˆåŒºåŸŸ                      â”‚
â”‚   è¾“å…¥åŒºåŸŸ              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚  â”‚  [ç¼©æ”¾] [æ¨¡å¼åˆ‡æ¢] [å¯¼å‡ºé€‰é¡¹]   â”‚  â”‚
â”‚   [æè¿°è¾“å…¥æ¡†...]      â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚   [ç”Ÿæˆ] [é‡æ–°ç”Ÿæˆ]    â”‚  â”‚                                 â”‚  â”‚
â”‚                        â”‚  â”‚                                 â”‚  â”‚
â”‚   Mermaid ä»£ç          â”‚  â”‚        Mermaid å›¾è¡¨é¢„è§ˆ         â”‚  â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚  â”‚                                 â”‚  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚                                 â”‚  â”‚
â”‚   â”‚ graph TD      â”‚   â”‚  â”‚                                 â”‚  â”‚
â”‚   â”‚ A --> B       â”‚   â”‚  â”‚                                 â”‚  â”‚
â”‚   â”‚ B --> C       â”‚   â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚ æ‹–æ‹½å¹³ç§» / æ»šè½®ç¼©æ”¾             â”‚  â”‚
â”‚   [ä¿®å¤æ ¼å¼] [æ¸²æŸ“]   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚   [å¤åˆ¶ä»£ç ]           â”‚                                       â”‚
â”‚                        â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒåŠŸèƒ½

#### 1. AI ç”Ÿæˆæµç¨‹å›¾

```javascript
onGenerateDiagram()             // è§¦å‘ AI ç”Ÿæˆ
onRegenerateDiagram()           // é‡æ–°ç”Ÿæˆ
_callDiagramAI(sPrompt, bIsFixRequest) // è°ƒç”¨ AI æµå¼æ¥å£
_processAIResponse(sResponse, bIsFixRequest) // å¤„ç† AI å“åº”
_extractMermaidCode(sResponse)  // æå– Mermaid ä»£ç 
_cleanMermaidCode(sCode)        // æ¸…ç†å’Œä¿®å¤ä»£ç 
```

#### 2. Mermaid æ¸²æŸ“

```javascript
_initMermaid()                  // åˆå§‹åŒ– Mermaid åº“
_configureMermaid()             // é…ç½® Mermaid ä¸»é¢˜
_renderMermaid(sMermaidCode)    // æ¸²æŸ“å›¾è¡¨
onRenderMermaid()               // æ‰‹åŠ¨è§¦å‘æ¸²æŸ“
_showRenderError(sError)        // æ˜¾ç¤ºæ¸²æŸ“é”™è¯¯
```

#### 3. è§†å›¾æ¨¡å¼

```javascript
onViewModeChange(oEvent)        // åˆ‡æ¢é¢„è§ˆ/ä»£ç è§†å›¾
// æ”¯æŒä¸¤ç§æ¨¡å¼ï¼š
// - preview: å›¾è¡¨é¢„è§ˆ
// - code: ä»£ç è§†å›¾
```

#### 4. ç¼©æ”¾æ§åˆ¶

```javascript
_ZOOM_STEP: 0.15,
_MIN_ZOOM: 0.2,
_MAX_ZOOM: 3,

onZoomIn()                      // æ”¾å¤§
onZoomOut()                     // ç¼©å°
onResetZoom()                   // é‡ç½®ç¼©æ”¾
_applyZoom(nZoom)               // åº”ç”¨ç¼©æ”¾
```

#### 5. äº¤äº’åŠŸèƒ½

```javascript
_initInteractions()             // åˆå§‹åŒ–æ‹–æ‹½å’Œç¼©æ”¾
// æ”¯æŒï¼š
// - é¼ æ ‡æ‹–æ‹½å¹³ç§»
// - æ»šè½®ç¼©æ”¾
```

#### 6. å¯¼å‡ºåŠŸèƒ½

```javascript
onDownloadPNG()                 // ä¸‹è½½ PNG
onDownloadSVG()                 // ä¸‹è½½ SVG
onCopyImage()                   // å¤åˆ¶å›¾ç‰‡åˆ°å‰ªè´´æ¿
onCopyMermaid()                 // å¤åˆ¶ Mermaid ä»£ç 
_svgToPng(oSvg, fnCallback)     // SVG è½¬ PNG
_downloadFile(sUrl, sFilename)  // è§¦å‘æ–‡ä»¶ä¸‹è½½
```

#### 7. Draw.io é›†æˆ

```javascript
onOpenInDrawio()                // æ‰“å¼€ Draw.io ç¼–è¾‘å™¨
_initDrawioEmbed()              // åˆå§‹åŒ–åµŒå…¥ç‰ˆ
_handleDrawioMsg(msg)           // å¤„ç† Draw.io æ¶ˆæ¯
_handleDrawioExport(msg)        // å¤„ç†å¯¼å‡º
onDrawioExportPNG()             // ä» Draw.io å¯¼å‡º PNG
onDrawioExportSVG()             // ä» Draw.io å¯¼å‡º SVG
onDrawioSave()                  // ä¿å­˜å¹¶å…³é—­
```

#### 8. ä¿®å¤åŠŸèƒ½

```javascript
onFixOutputFormat()             // ä¸€é”®ä¿®å¤ Mermaid æ ¼å¼
// åŒ…æ‹¬ï¼š
// - ç§»é™¤ä»£ç å—æ ‡è®°
// - ä¿®å¤å¸¸è§è¯­æ³•é—®é¢˜
// - è§„èŒƒåŒ–èŠ‚ç‚¹ ID
// - è‡ªåŠ¨é‡æ–°æ¸²æŸ“
```

---

## ğŸ¨ æ ·å¼ç³»ç»Ÿ (CSS)

### æ–‡ä»¶ä½ç½®
- `css/style.css`

### æ ·å¼åˆ†ç±»

#### 1. èŠå¤©ç•Œé¢æ ·å¼ (Lines 1-400)
- `.chatContainer` - èŠå¤©å®¹å™¨å¸ƒå±€
- `.messageItem` - æ¶ˆæ¯é¡¹æ ·å¼
- `.userMessage` / `.aiMessage` - æ¶ˆæ¯æ–¹å‘
- `.messageContent` - æ¶ˆæ¯å†…å®¹æ°”æ³¡
- `.inputArea` - è¾“å…¥åŒºåŸŸ

#### 2. Markdown æ¸²æŸ“æ ·å¼
- `.messageText` - æ–‡æœ¬æ ·å¼
- `.codeBlockWrapper` - ä»£ç å—åŒ…è£…å™¨
- `.copyButton` - å¤åˆ¶æŒ‰é’®

#### 3. é¦–é¡µ Launchpad æ ·å¼ (Lines 390-560)
- `.homePageBackground` - é¦–é¡µèƒŒæ™¯
- `.welcomeSection` - æ¬¢è¿åŒºåŸŸ
- `.aiTile` - AI åŠ©æ‰‹ç£è´´ï¼ˆè“è‰²æ¸å˜ï¼‰
- `.toolTile` - å·¥å…·ç£è´´ï¼ˆç»¿è‰²æ¸å˜ï¼‰
- `.diagramTile` - æµç¨‹å›¾ç£è´´ï¼ˆç´«è‰²æ¸å˜ï¼‰

#### 4. æµç¨‹å›¾é¡µé¢æ ·å¼ (Lines 568-900)
- `.diagramInputPanel` - å·¦ä¾§è¾“å…¥é¢æ¿
- `.diagramPreviewPanel` - å³ä¾§é¢„è§ˆé¢æ¿
- `.mermaidPreviewArea` - Mermaid é¢„è§ˆåŒºåŸŸ
- `.mermaidRenderContainer` - æ¸²æŸ“å®¹å™¨
- `.renderErrorContainer` - é”™è¯¯æ˜¾ç¤º

#### 5. æ–‡ä»¶ä¸Šä¼ æ ·å¼
- `.attachmentPreviewArea` - é™„ä»¶é¢„è§ˆåŒºåŸŸ
- `.attachmentCard` - æ–‡ä»¶å¡ç‰‡
- `.uploadProgressBar` - ä¸Šä¼ è¿›åº¦æ¡

#### 6. Draw.io å¯¹è¯æ¡†æ ·å¼
- `.drawioDialogCompact` - ç´§å‡‘å¯¹è¯æ¡†
- `.drawioCompactHeader` - å¤´éƒ¨æ 

### å“åº”å¼æ–­ç‚¹

```css
@media (max-width: 768px) {
    /* ç§»åŠ¨ç«¯é€‚é… */
}

@supports (-webkit-touch-callout: none) {
    /* iOS Safari ç‰¹æ®Šå¤„ç† */
}
```

### åŠ¨ç”»æ•ˆæœ

```css
@keyframes fadeIn { /* æ¶ˆæ¯æ·¡å…¥ */ }
@keyframes typing { /* æ‰“å­—æŒ‡ç¤ºå™¨ */ }
```

---

## ğŸŒ å›½é™…åŒ– (i18n)

### æ”¯æŒçš„è¯­è¨€

| è¯­è¨€ | æ–‡ä»¶ | åŒºåŸŸè®¾ç½® |
|-----|------|---------|
| è‹±æ–‡ï¼ˆé»˜è®¤ï¼‰ | `i18n.properties` | `""` |
| è‹±æ–‡ | `i18n_en.properties` | `en` |
| ç®€ä½“ä¸­æ–‡ | `i18n_zh_CN.properties` | `zh_CN` |

### å…³é”® i18n é”®

#### é€šç”¨
- `appTitle` - åº”ç”¨æ ‡é¢˜
- `appDescription` - åº”ç”¨æè¿°

#### é¦–é¡µ
- `welcomeTitle` - æ¬¢è¿æ ‡é¢˜
- `welcomeSubtitle` - æ¬¢è¿å‰¯æ ‡é¢˜
- `aiAssistantsCategory` - AI åŠ©æ‰‹åˆ†ç±»
- `toolsCategory` - å·¥å…·åˆ†ç±»

#### AI åŠ©æ‰‹
- `abapCleanCoreTitle` / `abapCleanCoreSubtitle`
- `cpiTitle` / `cpiSubtitle`
- `funcDocTitle` / `funcDocSubtitle`
- `techDocTitle` / `techDocSubtitle`
- `codeReviewTitle` / `codeReviewSubtitle`
- `unitTestTitle` / `unitTestSubtitle`

#### èŠå¤©é¡µé¢
- `welcomeTitle_{aiType}` - æ¬¢è¿æ ‡é¢˜
- `welcomeMessage_{aiType}` - æ¬¢è¿æ¶ˆæ¯
- `newConversation` - æ–°å»ºå¯¹è¯
- `sendMessage` - å‘é€æ¶ˆæ¯

#### æµç¨‹å›¾é¡µé¢
- `diagramTitle` - é¡µé¢æ ‡é¢˜
- `generateButton` - ç”ŸæˆæŒ‰é’®
- `renderButton` - æ¸²æŸ“æŒ‰é’®
- `downloadPNG` / `downloadSVG` - å¯¼å‡ºæŒ‰é’®

---

## ğŸ“Š æ•°æ®æ¨¡å‹

### chat æ¨¡å‹

å®šä¹‰åœ¨ `manifest.json` ä¸­ï¼š

```json
{
    "type": "sap.ui.model.json.JSONModel",
    "settings": {
        "data": {
            "messages": [],
            "conversations": [],
            "currentConversationId": null,
            "attachments": [],
            "inputValue": "",
            "isLoading": false,
            "sidebarExpanded": true
        }
    }
}
```

### å¯¹è¯æ•°æ®ç»“æ„

```javascript
{
    id: "conv_1234567890",
    title: "å¯¹è¯æ ‡é¢˜",
    aiType: "abap-clean-core",
    createdAt: "2025-01-08T10:00:00Z",
    sessionId: "xxx",           // ç™¾ç‚¼ session_id
    messages: [
        {
            id: "msg_1",
            role: "user",       // user | assistant
            content: "æ¶ˆæ¯å†…å®¹",
            timestamp: "2025-01-08T10:00:00Z"
        }
    ],
    sessionInfo: {
        createdAt: "2025-01-08T10:00:00Z",
        roundCount: 5
    }
}
```

### é™„ä»¶æ•°æ®ç»“æ„

```javascript
{
    id: "att_1234567890",
    file: File,                  // åŸå§‹æ–‡ä»¶å¯¹è±¡
    fileName: "document.pdf",
    size: 1024000,
    status: "ready",            // uploading | processing | ready | error
    fileId: "file_session_xxx", // ç™¾ç‚¼æ–‡ä»¶ ID
    progress: 100,
    error: null
}
```

---

## ğŸ”§ ç¬¬ä¸‰æ–¹åº“é›†æˆ

### åº“åˆ—è¡¨

| åº“åç§° | ç‰ˆæœ¬ | ç”¨é€” | åŠ è½½æ–¹å¼ |
|-------|------|------|---------|
| marked.js | latest | Markdown è§£æ | Local |
| highlight.js | latest | ä»£ç è¯­æ³•é«˜äº® | Local |
| mermaid.js | latest | æµç¨‹å›¾æ¸²æŸ“ | CDN |
| Draw.io Embed | - | å›¾è¡¨ç¼–è¾‘ | iframe |

### CDN åŠ è½½

åœ¨ `index.html` æˆ– `Component.js` ä¸­åŠ¨æ€åŠ è½½ï¼š

```html
<!-- Marked.js -->
<script src="lib/marked.min.js"></script>

<!-- Highlight.js -->
<link rel="stylesheet" href="css/highlight-github-dark.min.css">
<script src="lib/highlight.min.js"></script>

<!-- Mermaid (Optional) -->
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
```

---

## ğŸ“ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„ AI åŠ©æ‰‹

1. **åœ¨ Home.view.xml æ·»åŠ ç£è´´**:
```xml
<GenericTile
    header="{i18n>newAssistantTitle}"
    subheader="{i18n>newAssistantSubtitle}"
    class="aiTile"
    press="onTilePress">
    <tileContent>
        <TileContent>
            <content>
                <ImageContent src="sap-icon://icon-name" />
            </content>
        </TileContent>
    </tileContent>
    <customData>
        <core:CustomData key="aiType" value="new-assistant" />
    </customData>
</GenericTile>
```

2. **åœ¨ i18n æ–‡ä»¶æ·»åŠ ç¿»è¯‘**:
```properties
# i18n.properties
newAssistantTitle=New Assistant
newAssistantSubtitle=Description of new assistant
welcomeTitle_new-assistant=Welcome to New Assistant
welcomeMessage_new-assistant=I can help you with...
```

3. **åœ¨åç«¯æ·»åŠ  App ID æ˜ å°„**ï¼ˆè§åç«¯è¯´æ˜æ–‡æ¡£ï¼‰

### æ·»åŠ æ–°é¡µé¢

1. **åˆ›å»ºè§†å›¾**: `view/NewPage.view.xml`
2. **åˆ›å»ºæ§åˆ¶å™¨**: `controller/NewPage.controller.js`
3. **åœ¨ manifest.json æ·»åŠ è·¯ç”±**:
```json
{
    "routes": [
        {
            "name": "newPage",
            "pattern": "new-page",
            "target": "newPage"
        }
    ],
    "targets": {
        "newPage": {
            "viewName": "NewPage",
            "viewLevel": 2
        }
    }
}
```

### è‡ªå®šä¹‰æ ·å¼

ç›´æ¥ç¼–è¾‘ `css/style.css` æ–‡ä»¶ï¼Œæ ·å¼ä¼šè‡ªåŠ¨åº”ç”¨ã€‚

---

## ğŸ› è°ƒè¯•æŠ€å·§

1. **å¯ç”¨ UI5 è°ƒè¯•æ¨¡å¼**:
   - URL æ·»åŠ  `?sap-ui-debug=true`

2. **ç¦ç”¨è§†å›¾ç¼“å­˜**:
   - URL æ·»åŠ  `?sap-ui-xx-viewCache=false`

3. **æŸ¥çœ‹æ¨¡å‹æ•°æ®**:
   ```javascript
   this.getView().getModel("chat").getData()
   ```

4. **æµè§ˆå™¨å¼€å‘è€…å·¥å…·**:
   - Network æ ‡ç­¾æŸ¥çœ‹ SSE äº‹ä»¶æµ
   - Console æŸ¥çœ‹æ—¥å¿—è¾“å‡º
