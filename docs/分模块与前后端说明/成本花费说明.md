# 成本花费说明

> **版本**: v1.4.3  
> **更新日期**: 2025-01-08  
> **币种**: 人民币 (CNY)

---

## 📋 目录

1. [成本概览](#1-成本概览)
2. [阿里云百炼费用](#2-阿里云百炼费用)
3. [SAP BTP 费用](#3-sap-btp-费用)
4. [可选服务费用](#4-可选服务费用)
5. [成本优化建议](#5-成本优化建议)
6. [费用预估示例](#6-费用预估示例)

---

## 1. 成本概览

### 1.1 费用分类

| 费用类别 | 是否必需 | 付费模式 | 月费用范围 |
|---------|---------|---------|-----------|
| 阿里云百炼 AI 调用 | ✅ 必需 | 按量付费 | ¥50-2000+ |
| 阿里云百炼文件上传 | ⚠️ 可选 | 按量付费 | ¥0-100 |
| SAP BTP 运行时 | ✅ 必需 | 按配额 | ¥0-500+ |
| 阿里云 RDS 数据库 | ⚠️ 可选 | 包年包月/按量 | ¥70-500+ |
| 域名和证书 | ⚠️ 可选 | 按年付费 | ¥50-200/年 |

### 1.2 成本构成图

```
┌─────────────────────────────────────────────────────────────────┐
│                        总成本构成                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              阿里云百炼 (60-80%)                         │   │
│  │  ┌───────────────────┐  ┌───────────────────┐          │   │
│  │  │  AI 模型调用费用   │  │  文件上传/解析费用  │          │   │
│  │  │  (主要成本)       │  │  (可选)           │          │   │
│  │  └───────────────────┘  └───────────────────┘          │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              SAP BTP (10-30%)                            │   │
│  │  ┌───────────────────┐  ┌───────────────────┐          │   │
│  │  │  Node.js 运行时    │  │  HTML5 托管       │          │   │
│  │  │  (后端服务)       │  │  (前端静态资源)    │          │   │
│  │  └───────────────────┘  └───────────────────┘          │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              可选服务 (0-20%)                            │   │
│  │  ┌───────────────────┐  ┌───────────────────┐          │   │
│  │  │  RDS 数据库       │  │  其他服务          │          │   │
│  │  │  (数据持久化)      │  │                   │          │   │
│  │  └───────────────────┘  └───────────────────┘          │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 2. 阿里云百炼费用

### 2.1 AI 模型调用费用（主要成本）

百炼应用调用按 **token 数量** 计费。

#### 计费标准

| 模型 | 输入价格 | 输出价格 | 说明 |
|-----|---------|---------|------|
| 通义千问-Max | ¥0.02/千tokens | ¥0.06/千tokens | 推荐用于复杂任务 |
| 通义千问-Plus | ¥0.004/千tokens | ¥0.012/千tokens | 性价比高 |
| 通义千问-Turbo | ¥0.002/千tokens | ¥0.006/千tokens | 适合简单任务 |
| 通义千问-Long | ¥0.0005/千tokens | ¥0.002/千tokens | 长文本处理 |

> **注意**: 使用百炼应用（Apps）时，系统 prompt 也会计入 token 消耗。

#### Token 估算

- 1 个中文字 ≈ 1-2 tokens
- 1 个英文单词 ≈ 1-3 tokens
- 1 行代码 ≈ 10-30 tokens

#### 示例计算

假设使用 **通义千问-Plus**，单次对话：
- 用户输入: 500 tokens
- 系统 prompt: 1000 tokens
- AI 输出: 2000 tokens

```
输入费用 = (500 + 1000) × ¥0.004 / 1000 = ¥0.006
输出费用 = 2000 × ¥0.012 / 1000 = ¥0.024
单次费用 = ¥0.03
```

### 2.2 免费额度

新用户通常有免费试用额度：

| 资源 | 免费额度 | 有效期 |
|-----|---------|-------|
| 通义千问系列 | 100万 tokens | 开通后 180 天 |
| 文件解析 | 一定次数 | 开通后 30 天 |

> 具体额度以阿里云官网公告为准。

### 2.3 文件上传相关费用

#### 文件解析费用

| 服务 | 计费方式 | 价格 |
|-----|---------|------|
| 文档解析（DOCMIND） | 按页数 | ¥0.01-0.05/页 |
| 会话文件存储 | 临时免费 | ¥0 |

#### 文件大小限制

- 单文件最大: 50MB
- 单会话最大: 5 个文件

### 2.4 费用查询

登录 [阿里云费用中心](https://usercenter2.aliyun.com/) 查看：
- 账单详情 -> 百炼费用
- 资源包 -> 剩余额度

---

## 3. SAP BTP 费用

### 3.1 SAP BTP 定价模式

SAP BTP 采用 **Cloud Credits** 模式：

| 服务类型 | 免费配额（Free Tier） | 超出后计费 |
|---------|---------------------|-----------|
| Cloud Foundry 运行时 | 256 MB | 按 GB-小时 |
| XSUAA | 无限 | 免费 |
| HTML5 应用仓库 | 100MB | 按 GB |
| Destination | 10 个 | 按数量 |

### 3.2 本项目资源消耗

| 服务 | 配置 | 预计消耗 |
|-----|------|---------|
| Node.js 运行时 | 256MB × 1 实例 | 免费配额内 |
| HTML5 Repository | ~5MB | 免费配额内 |
| XSUAA | 1 实例 | 免费 |
| Destination | 2 个 | 免费配额内 |

### 3.3 企业账户

如果使用企业账户：

| 套餐 | 月费 (约) | Cloud Credits |
|-----|----------|---------------|
| 入门版 | 免费 | 有限 |
| 标准版 | $300-1000 | 中等 |
| 企业版 | $1000+ | 充足 |

### 3.4 费用优化

- **使用 Free Tier**: 个人学习和小型项目
- **优化实例大小**: 256MB 通常够用
- **按需扩展**: 避免过度配置

---

## 4. 可选服务费用

### 4.1 阿里云 RDS MySQL（数据持久化）

如果需要持久化存储对话历史：

| 规格 | 月费 (包年包月) | 适用场景 |
|-----|---------------|---------|
| 1核1GB 20GB | ¥70-100 | 开发测试 |
| 1核2GB 50GB | ¥150-200 | 小型生产 |
| 2核4GB 100GB | ¥300-500 | 中型生产 |

**按量付费**:
- 计算: ¥0.1-0.5/小时（按规格）
- 存储: ¥0.0015/GB/小时

### 4.2 阿里云 OSS（文件存储）

如果需要持久化存储上传文件：

| 存储类型 | 价格 | 说明 |
|---------|------|------|
| 标准存储 | ¥0.12/GB/月 | 热数据 |
| 低频存储 | ¥0.08/GB/月 | 不常访问 |
| 归档存储 | ¥0.033/GB/月 | 长期保存 |

请求费用：
- PUT/GET: ¥0.01/万次

### 4.3 域名和 SSL

| 服务 | 费用 | 周期 |
|-----|------|------|
| .com 域名 | ¥55-70 | /年 |
| .cn 域名 | ¥29-35 | /年 |
| SSL 证书（免费版） | ¥0 | /年 |
| SSL 证书（企业版） | ¥1000+ | /年 |

### 4.4 CDN 加速（可选）

| 流量 | 价格 |
|-----|------|
| 0-10GB/月 | 免费 |
| 10GB-10TB | ¥0.24/GB |

---

## 5. 成本优化建议

### 5.1 AI 调用优化

| 策略 | 节省比例 | 实施方法 |
|-----|---------|---------|
| 选择合适模型 | 30-70% | 简单任务用 Turbo，复杂任务用 Plus |
| 优化 prompt | 10-20% | 精简系统 prompt |
| 限制对话轮次 | 20-40% | 超过 50 轮开启新对话 |
| 缓存常见问题 | 10-30% | 本地缓存高频回答 |

### 5.2 session_id 策略

本项目已实现的会话策略可以节省成本：

```javascript
// 使用 session_id 模式
// 不需要每次发送完整历史，节省 token
const SESSION_CONFIG = {
    MAX_ROUNDS: 50,      // 50 轮后切换
    EXPIRE_HOURS: 1      // 1 小时过期
};
```

### 5.3 模型选择策略

| 任务类型 | 推荐模型 | 原因 |
|---------|---------|------|
| 代码审查 | Plus | 需要理解能力 |
| 文档生成 | Plus | 输出质量要求高 |
| 简单问答 | Turbo | 快速响应 |
| 流程图生成 | Plus | 格式要求严格 |
| 长文档分析 | Long | 长上下文 |

### 5.4 资源包购买

如果使用量大，考虑购买资源包：

| 资源包 | 价格 | 有效期 | 折扣 |
|-------|------|-------|------|
| 100万 tokens | ¥50 | 1年 | 约 8 折 |
| 500万 tokens | ¥200 | 1年 | 约 7 折 |
| 2000万 tokens | ¥600 | 1年 | 约 6 折 |

---

## 6. 费用预估示例

### 6.1 个人/学习场景

**假设**:
- 每天 20 次对话
- 平均每次 2000 tokens（输入+输出）
- 使用 Turbo 模型
- 偶尔上传文件

| 项目 | 月费用 |
|-----|-------|
| AI 调用 (20×30×2000 tokens) | ¥10-15 |
| 文件解析 | ¥0-5 |
| SAP BTP (Free Tier) | ¥0 |
| **合计** | **¥10-20** |

### 6.2 小团队场景

**假设**:
- 5 人团队
- 每人每天 50 次对话
- 平均每次 3000 tokens
- 使用 Plus 模型
- 需要数据持久化

| 项目 | 月费用 |
|-----|-------|
| AI 调用 (5×50×30×3000 tokens) | ¥300-500 |
| 文件解析 | ¥20-50 |
| SAP BTP | ¥0-200 |
| RDS MySQL (基础版) | ¥100 |
| **合计** | **¥420-850** |

### 6.3 企业生产场景

**假设**:
- 50 人使用
- 每人每天 100 次对话
- 平均每次 4000 tokens
- 使用 Plus/Max 混合
- 完整基础设施

| 项目 | 月费用 |
|-----|-------|
| AI 调用 | ¥3000-8000 |
| 文件解析 | ¥200-500 |
| SAP BTP (标准版) | ¥500-2000 |
| RDS MySQL (生产版) | ¥300-500 |
| OSS 存储 | ¥50-100 |
| CDN/域名 | ¥50-100 |
| **合计** | **¥4100-11200** |

---

## 📊 费用监控

### 阿里云费用告警

1. 登录阿里云控制台
2. 进入 **费用中心** -> **费用告警**
3. 设置预算告警（如月消费超过 ¥500 告警）

### SAP BTP 用量监控

1. 登录 BTP Cockpit
2. 进入 **Usage** 页面
3. 查看各服务使用量

### 推荐告警阈值

| 服务 | 告警阈值 | 说明 |
|-----|---------|------|
| 百炼月消费 | ¥200 | 个人使用 |
| 百炼月消费 | ¥1000 | 团队使用 |
| BTP 运行时 | 80% 配额 | 即将超出 |

---

## 📝 总结

### 最低成本运行

| 服务 | 选择 | 月费用 |
|-----|------|-------|
| AI 模型 | Turbo | ¥10-50 |
| SAP BTP | Free Tier | ¥0 |
| 数据存储 | localStorage | ¥0 |
| **合计** | | **¥10-50** |

### 推荐生产配置

| 服务 | 选择 | 月费用 |
|-----|------|-------|
| AI 模型 | Plus + 资源包 | ¥200-500 |
| SAP BTP | 标准版 | ¥200-500 |
| 数据库 | RDS 基础版 | ¥100-150 |
| **合计** | | **¥500-1150** |

---

*最后更新: 2025-01-08*  
*价格信息仅供参考，以阿里云/SAP 官网实时价格为准*
